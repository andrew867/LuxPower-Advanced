Please read the first readme BEFORE following any instructions on this page, this is more of a notes page and likely will not work for you the first time around.

# Changing the time in HA for Lux times
This is a work in progess  - do not use it yet.

Below is to just change the AC start and end time and display them correctly, you can do it for the others if you wish for discharging etc.

Firstly we need to create Helpers for each of the following to help us. Navigate to "Settings.Devices & Services", click on the Helpers at the top and then click "+ Create Helper" button on the bottom right.

Then create a "Date and or time" helper for each of following, paste each of these names into the Name field and remember click on "time" radio button at the bottom ( helpers need to be exactly the same suffix as the number sensors generated by the integration) :


LUX - AC Charge Start1

LUX - AC Charge End1

LUX - Force Charge Start1

LUX - Force Charge End1

LUX - Force Discharge Start1

LUX - Force Discharge End1

After that we will have 5 "date and/or time" helpers.

Next, we need to create two automations to help us link this all together. Navigate to Settings.Automations and click on the "+ Create Automation" button on the bottom right. Create 2 automations, clicking on "Start with an empty automation" for each of the following. Click on the 3 vertical dots on the top right Simply copy and select the "Edit in YAML" option. Paste the following under "New Automation", replacing the existing text:

First 
```
alias: Auto Set HA Input On Lux Timer Change
description: ""
trigger:
  - platform: state
    entity_id:
      - number.lux_ac_charge_start1
      - number.lux_ac_charge_end1
      - number.lux_force_charge_start1
      - number.lux_force_charge_end1
      - number.lux_force_discharge_start1
      - number.lux_force_discharge_end1
condition: []
action:
  - service: input_datetime.set_datetime
    data:
      time: >
        {% set minutes = (states(trigger.entity_id)|int / 256)|int  %}  {% set
        hours = states(trigger.entity_id)|int - minutes * 256  %} {{
        '%0.2d'|format(hours)+':'+'%0.2d'|format(minutes)+':00' }}
    target:
      entity_id: >
        {% set entity_suffix = trigger.entity_id[10:] %}
        {{'input_datetime.lux'~entity_suffix}}
mode: single
```

Second
```
alias: Auto Set Lux Timer On HA Input Change
description: ""
trigger:
  - platform: state
    entity_id:
      - input_datetime.lux_ac_charge_start1
      - input_datetime.lux_ac_charge_end1
      - input_datetime.lux_force_charge_start1
      - input_datetime.lux_force_charge_end1
      - input_datetime.lux_force_discharge_start1
      - input_datetime.lux_force_discharge_end1
condition: []
action:
  - service: number.set_value
    data:
      value: >-
        {{state_attr(trigger.entity_id, 'minute')|int * 256 +
        state_attr(trigger.entity_id, 'hour')|int }}
    target:
      entity_id: >-
        {% set entity_suffix = trigger.entity_id[18:] %}
        {{'number.lux'~entity_suffix}}
mode: single
```

Finally, go to one of your views, select "Edit Dashboard" after you've clicked on the 3 vertical dots on the top right.

On the bottom right, click on "+ Add Card", scroll to the bottom of the list and click on "Manual - Need to add a custom card or just want to manually write the YAML?" You can then copy and paste this YAML into card to show the times in HA:
```
type: entities
entities:
  - entity: input_datetime.lux_ac_charge_start1
  - entity: input_datetime.lux_ac_charge_end1
  - entity: input_datetime.lux_force_charge_start1
  - entity: input_datetime.lux_force_charge_end1
title: Lux Charge Times
show_header_toggle: false
```


# Below will refresh the data in HA every 30 seconds.
This is a work in progess  

Import the automation below, this will refresh the data roughly every 30 seconds depending when the inverter reads our request. WARNING: DO NOT SET IT LOWER OR IT WILL BREAK! This is due to the inverter taking time to respond, not my code!

You MUST include your dongle number below!
```
alias: "DEBUG - refresh Lux regularly "
description: ""
trigger:
  - platform: time_pattern
    seconds: "30"
condition: []
action:
  - service: luxpower.luxpower_refresh_registers
    data:
      dongle: BA*******
mode: single

```

# LoveLace (GUI Example)
In order to help you off, you can create a new card in LoveLace. 
Simply go to, Settings > Dashboards> Click on the Dashboard you want to add or click on "Open" on Overview if you don't have a custom one.
Click on the three dots ... at the top right and click Edit Dashboard. At the bottom right click "Add Card" , scroll to the bottom and find "Manual" and click on it, delete the prefilled text then copy and paste the below:
```
type: vertical-stack
cards:
  - type: entities
    entities:
      - entity: switch.lux_power_backup_enable
        name: Power Backup (EPS)
    title: Application Setting
    show_header_toggle: false
  - type: entities
    entities:
      - entity: number.lux_system_charge_power_rate
        name: System Charge Power Rate
        icon: mdi:water-percent
    title: Charge Settings
  - type: entities
    entities:
      - entity: switch.lux_ac_charge_enable
      - entity: number.lux_ac_charge_power_rate
      - entity: number.lux_ac_battery_charge_level
      - entity: input_datetime.lux_ac_charge_start1
      - entity: input_datetime.lux_ac_charge_end1
    title: AC Charge
  - type: entities
    entities:
      - entity: switch.lux_charge_priority
      - entity: number.lux_priority_charge_rate
      - entity: number.lux_priority_charge_level
      - entity: input_datetime.lux_force_charge_start1
      - entity: input_datetime.lux_force_charge_end1
    title: Charge Priority
    show_header_toggle: false
  - type: entities
    entities:
      - entity: number.lux_system_discharge_power_rate
      - entity: number.lux_on_grid_discharge_cut_off_soc
        icon: mdi:brightness-percent
      - entity: number.lux_off_grid_discharge_cut_off_soc
        icon: mdi:brightness-percent
      - entity: switch.lux_force_discharge_enable
      - entity: number.lux_forced_discharge_power_rate
      - entity: number.lux_off_grid_discharge_cut_off_soc
      - entity: input_datetime.lux_force_discharge_start1
      - entity: input_datetime.lux_force_discharge_end1
    title: Discharge Settings

```
then click Save.
If any sensors are wrong, just remove the "_2" off the sensor name. Tip: If you click on the view "Default", you will get an automatically generated list of all the sensors that are known by HA, you can usually find what you are looking for here, especially after clicking on it and inspecting its naming.
